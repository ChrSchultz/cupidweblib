<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" >

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <title>Actions</title>

    <script src="js/jquery-1.7.1.min.js"></script>
    <link rel="stylesheet" href="css/jquery.mobile-1.2.1.css" />
    <script src="js/jquery.mobile-1.2.1.js"></script>

    <link rel="stylesheet" href="css/jqm-docs.css" />
    <link rel="stylesheet" href="css/CuPID.css" />

    <script src="js/jqm-docs.js"></script>
    <script src="/js/iijslib.js" type="text/javascript"></script>
    <script src="/js/cupidjslib.js" type="text/javascript"></script>
</head>
<body>

<div data-role="page" class="type-home" id="main">
<script>

    // define some globals
    var jqmpage=true;
    var updatetimeout=100;
    var updateinterval=5000;
    var actauthlevel=2;

    //// Channels
    function UpdateActionsTable() {
        var callback=RenderActionsTable;
        wsgiCallbackTableData(controldatabase,'actions',callback);
    }
    function RenderActionsTable(datatable) {
        // Here we render html for each element retrieved
        // set top of indicator ul
        $("#actionset").html('');

        for (var i=0; i<datatable.length; i++){
            var index=i+1;
            divhtmlitemstring = '\
                <div data-role="collapsible" data-collapsed="true"  > <!--control item -->\
                    <h3><span class="actionsname' + index + '"></span></h3>\
                    <li data-role="fieldcontain">\
                        <fieldset class="ui-grid-a">\
                          <div class="ui-block-a ui-biglabel inset-header" style="width:30%">Type</div>\
                          <div class="ui-block-b ui-biglabel inset-header actionsactiontype' + index + '">Email</div>\
                        </fieldset>\
                    </li>\
                    <li data-role="fieldcontain">\
                        <fieldset class="ui-grid-a">\
                          <div class="ui-block-a ui-biglabel inset-header" style="width:30%">Detail</div>\
                          <div class="ui-block-b ui-biglabel inset-header actionsactiondetail' + index + '"></div>\
                        </fieldset>\
                    </li>\
                    <li data-role="fieldcontain">\
                        <span class="justalamp">\
                        <label for="actionenabledtoggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">\
                        Enabled\
                        </label>\
                        <select id="actionsenabled' + index + 'toggle" class="actionsenabled' + index + 'toggle justalamp" data-role="slider">\
                            <option value="Off">Off</option>\
                            <option value="On">On</option>\
                        </select>\
                        </span>\
                    </li>\
                    <li data-role="fieldcontain">\
                        <span class="justalamp">\
                        <label for="actionsstatus' + index + 'toggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">\
                        Status\
                        </label>\
                        <select id="actionsstatus' + index + 'toggle" class="actionsstatus' + index + 'toggle justalamp" data-role="slider">\
                            <option value="Off">Off</option>\
                            <option value="On">On</option>\
                        </select>\
                        </span>\
                    </li>\
                    <li data-role="fieldcontain">\
                        <span class="justalamp">\
                        <label for="actionactivetoggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">\
                        Active\
                        </label>\
                        <select id="actionactive' + index + 'toggle" class="actionactive' + index + 'toggle justalamp" data-role="slider">\
                            <option value="Off">Off</option>\
                            <option value="On">On</option>\
                        </select>\
                        </span>\
                    </li>\
                    <li data-role="collapsible-set" data-content-theme="c" data-theme="d" data-inset="true">\
                        <div data-role="collapsible" data-collapsed="true" >\
                            <h4>Edit</h4>\
                            <ul data-role="listview" data-inset="false">\
                                <li data-role="fieldcontain">\
                                    <label for="actionstatustoggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">\
                                    Enabled\
                                    </label>\
                                    <select id="actionsenabled' + index + 'toggle" class="actionsenabled' + index + 'toggle" data-role="slider">\
                                    <option value="Off">Off</option>\
                                    <option value="On">On</option>\
                                    </select>\
                                </li>\
                                <li>\
                                    <label for="actionscriteriontype' + index + 'jqmselect"><h3>Criteron Type</h3></label>\
                                    <select id="actionscriteriontype' + index + 'jqmselect" class="actionscriteriontype' + index + 'jqmselect">\
                                        <option value="dbvalue">dbvalue</option>\
                                    </select>\
                                </li>\
                                <li>\
                                    <label for="actionstablename' + index + 'jqmselect"><h3>Table</h3></label>\
                                    <select id="actionstablename' + index + 'jqmselect" class="actionstablename' + index + 'jqmselect controldatatableselect">\
                                        <option value="channels">channels</option>\
                                    </select>\
                                </li>\
                                 <li>\
                                    <label for="actionsvariablename' + index + 'jqmselect"><h3>Valuename</h3></label>\
                                    <select id="actionsvariablename' + index + 'jqmselect" class="actionsvariablename' + index + 'jqmselect controldatachannelscolumnjqmselect">\
                                        <option value="controlvalue">Control Value</option>\
                                        <option value="action">Action</option>\
                                    </select>\
                                </li>\
                                <li>\
                                    <label for="actionsoperator' + index + 'jqmselect"><h3>Operator</h3></label>\
                                    <select id="actionsoperator' + index + 'jqmselect" class="actionsoperator' + index + 'jqmselect actionsoperator' + index + 'jqmselect actionsoperatorselect">\
                                        <option value="=">= (Equal to)</option>\
                                        <option value=">">< (Less than)</option>\
                                        <option value="<">> (Greater than)</option>\
                                    </select>\
                                </li>\
                                <li>\
                                    <h3>Criterion Value</h3>\
                                    <div class="ui-grid-a">\
                                        <div class="ui-block-a"><input type="text" class="actionscriterion' + index + 'text"  value="detail"  ></div>\
                                        <div class="ui-block-b actionscriterion' + index + 'textupdate" id="actionscriterion' + index + 'textupdate" ><a data-theme="d" data-role="button" data-icon="check" data-mini="true">Update</a></div>\
                                    </div>\
                                </li>\
                                <li>\
                                    <label for="actionsactiontype' + index + 'jqmselect"><h3>Action Type</h3></label>\
                                    <select id="actionsactiontype' + index + 'jqmselect" class="actiontypeselect">\
                                        <option value="email">Email</option>\
                                        <option value="indicator">Indicator</option>\
                                    </select>\
                                </li>\
                                <li>\
                                    <h3>Detail</h3>\
                                    <div class="ui-grid-a">\
                                        <div class="ui-block-a "><input type="text" class="actionsactiondetail' + index + 'text"  value="detail" ></div>\
                                        <div class="ui-block-b actionsactiondetail' + index + 'textupdate" id="actionsactiondetail' + index + 'textupdate" ><a data-theme="d" data-role="button" data-icon="check" data-mini="true">Update</a></div>\
                                    </div>\
                                </li>\
                                <li data-role="fieldcontain">\
                                    <label for="actionsactivereset' + index + 'toggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">\
                                    Active Reset\
                                    </label>\
                                    <select id="actionsactivereset' + index + 'toggle" class="actionsactivereset' + index + 'toggle justalamp" data-role="slider">\
                                    <option value="Off">Off</option>\
                                    <option value="On">On</option>\
                                    </select>\
                                </li>\
                                <li data-role="fieldcontain">\
                                  <label for="actionsondelay' + index + 'slider" class="ui-biglabel">On Delay</label>\
                                  <input type="range" class="actionsondelay' + index + 'slider" id="actionsondelay' + index + 'slider" value="60" min="0" max="100" />\
                                </li>\
                                <li data-role="fieldcontain">\
                                  <label for="actionsoffdelay' + index + 'slider" class="ui-biglabel">Off Delay</label>\
                                  <input type="range" class="actionsoffdelay' + index + 'slider" id="actionsoffdelay' + index + 'slider" value="60" min="0" max="100" />\
                                </li>\
                                <li data-role="fieldcontain">\
                                  <label for="actionsactionfrequency' + index + 'slider" class="ui-biglabel">Action Frequency</label>\
                                  <input type="range" class="actionsactionfrequency' + index + 'slider" id="actionsactionfrequency' + index + 'slider" value="60" min="0" max="100" />\
                                </li>\
                            </ul><!-- Edit set-->\
                        </div><!-- Edit collapsible -->\
                    </li><!-- Edit Collapsible set -->\
                </div> <!-- Control Item -->'

            $('#actionset').append(divhtmlitemstring).trigger( "create" );

            // render tablenames based on database
            // this is currently done automatically, hardcoded because we are locked into
            // control database. One step at a time.

            // render columnnames based on table
            // action of tablename change is render of known id select to column names of new value
            // e.g. actionstable1jqmselect valuechange will render actionscolumn1jqmselect with new value

            $('#actionstablename' + index + 'jqmselect').on('change.options',function(){

//                alert('change to ' + $('#actionstablename' + index + 'jqmselect').val())
                UpdateColumnsData({classes:['actionsvariablename' + index + 'jqmselect'], database:controldatabase,table:$('#actionstablename' + index + 'jqmselect').val()})
            })

            // attach action to tablename change event
        }

        $('#actionset').trigger('create');
        $('#actionslistview').listview('refresh');

        UpdateActionsData({'jqmpage':true})
    }

    $(document).ready(function(){
        togglestolamps()
        //// Control Algorithms
        //Just run this once so we don't overwrite edited values
        UpdateActionsTable({jqmpage:true})
        setTimeout(function(){UpdateTablesData({database:controldatabase})},2000)
        setTimeout(function(){UpdateColumnsData({database:controldatabase,table:'channels'})},2000)
        setTimeout(function(){ UpdateActionsData({'jqmpage':true,timeout:updateinterval})},2000)

    });
</script>

<div data-role="content">
    <div class="content-secondary">
        <ul data-role="listview" data-inset="true">
            <li data-role="list-divider"><h4>Test Indicators</h4></li>
            <li data-role="fieldcontain" >
                <p>This page details the actions that your CuPID will take on conditions you set. </p>
                <p>Currently supported actions are email and indicators alerts. Expand the Details below for explanations of each of the parameters.</p>
            </li>
            <div data-role="collapsible-set" data-inset="false" data-content-theme="b">
                <div data-role="collapsible" data-collapsed="true"  > <!--control item -->
                  <h3>Parameters</h3>
                    <p><strong>Type:</strong>  Action to take on active alert. Email and Indicator alerts are currently supported.</p>
                    <p><strong>Action Detail:</strong>  Additional action information. For type email, this is the email field. For indicator, this is the name of the indicator.</p>
                    <p><strong>On/Off Delay:</strong>  These values determine how long the alert status must be met or returned to normal before the action is set to active or inactive.</p>
                    <p><strong>Action Frequency:</strong>  Determines how often the action will be attempted. For an email, this determines how often it will be set.</p>
                    <p><strong>On/Offtime:</strong>  The last status change from off to on (ontime) and on to off (offtime).</p>
                    <p><strong>Lastactiontime:</strong>  Last time the action was carried out, e.g. the last email time.</p>
                    <p><strong>Lastactiontime:</strong>  Last time the action was carried out, e.g. the last email time.</p>
                    <p><strong>Database:</strong>  Database for alert criterion values.</p>
                    <p><strong>Tablename:</strong>  Tablename for database criterion values.</p>
                    <p><strong>Variablename:</strong>  Variable for database criterion values.</p>
                </div>
            </div>
            <li >
                <a href="testindicators.html" data-ajax="false">Test Indicators</a>
            </li>
        </ul>
    </div><!--/content-secondary-->
    <div class="content-primary">
        <ul data-role="listview" data-inset="true" data-dividertheme="c" id="actionslistview">
            <li data-role="list-divider">
                <h4>Actions</h4>
            </li>
            <div data-role="collapsible-set" data-inset="false" data-content-theme="b" id="actionset">
                <div data-role="collapsible" data-collapsed="true"  > <!--control item -->
                    <h3>Actions loading ...</h3>
                    <li data-role="fieldcontain">
                        <fieldset class="ui-grid-a">
                          <div class="ui-block-a ui-biglabel inset-header" style="width:30%">Type</div>
                          <div class="ui-block-b ui-biglabel inset-header">Email</div>
                        </fieldset>
                    </li>
                    <li data-role="fieldcontain">
                        <fieldset class="ui-grid-a">
                          <div class="ui-block-a ui-biglabel inset-header" style="width:30%">Detail</div>
                          <div class="ui-block-b ui-biglabel inset-header">test@interfaceinnovations.org</div>
                        </fieldset>
                    </li>
                    <li data-role="fieldcontain">
                        <span class="justalamp">
                        <label for="actionenabledtoggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">
                        Enabled
                        </label>
                        <select id="actionenabledtoggle" class="actionenabledtoggle justalamp" data-role="slider">
                            <option value="Off">Off</option>
                            <option value="On">On</option>
                        </select>
                        </span>
                    </li>
                    <li data-role="fieldcontain">
                        <span class="justalamp">
                        <label for="actionstatustoggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">
                        Status
                        </label>
                        <select id="actionstatustoggle" class="actionstatustoggle justalamp" data-role="slider">
                            <option value="Off">Off</option>
                            <option value="On">On</option>
                        </select>
                        </span>
                    </li>
                    <li data-role="fieldcontain">
                        <span class="justalamp">
                        <label for="actionstatustoggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">
                        Active
                        </label>
                        <select id="actionstatustoggle" class="actionstatustoggle justalamp" data-role="slider">
                            <option value="Off">Off</option>
                            <option value="On">On</option>
                        </select>
                        </span>
                    </li>
                    <li data-role="collapsible-set" data-content-theme="c" data-theme="d" data-inset="true">
                        <div data-role="collapsible" data-collapsed="false" >
                            <h4>Edit</h4>
                            <ul data-role="listview" data-inset="false">
                                <li data-role="fieldcontain">
                                    <label for="actionstatustoggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">
                                    Enabled
                                    </label>
                                    <select id="actionstatustoggle" class="actionstatustoggle justalamp" data-role="slider">
                                    <option value="Off">Off</option>
                                    <option value="On">On</option>
                                    </select>
                                </li>
                                <li>
                                    <label for="criteriontypejqmselect"><h3>Criteron Type</h3></label>
                                    <select id="criteriontypejqmselect" class="actiontypeselect">
                                        <option value="dbvalue">dbvalue</option>
                                    </select>
                                </li>
                                <li>
                                    <label for="criteriontypejqmselect"><h3>Table</h3></label>
                                    <select id="criteriontypejqmselect" class="actiontypeselect">
                                        <option value="channels">channels</option>
                                    </select>
                                </li>
                                 <li>
                                    <label for="criteriontypejqmselect"><h3>Valuename</h3></label>
                                    <select id="criteriontypejqmselect" class="actiontypeselect">
                                        <option value="controlvalue">Control Value</option>
                                        <option value="action">Action</option>
                                    </select>
                                </li>
                                <li>
                                    <label for="criteriontypejqmselect"><h3>Operator</h3></label>
                                    <select id="criteriontypejqmselect" class="actiontypeselect">
                                        <option value="=">= (Equal to)</option>
                                        <option value=">">< (Less than)</option>
                                        <option value="<">> (Greater than)</option>
                                    </select>
                                </li>
                                <li>
                                    <h3>Criterion Value</h3>
                                    <div class="ui-grid-a">
                                        <div class="ui-block-a ui-buttontextpartner" "><input type="text" class="actionsname' + index + 'text"  value="detail" style="margin-top:0px" ></div>
                                        <div class="ui-block-b channelsname' + index + 'textupdate" id="channelsname' + index + 'textupdate" ><a data-theme="d" data-role="button" data-icon="check">Update</a></div>
                                    </div>
                                </li>
                                <li>
                                    <label for="actionsactiontypejqmselect"><h3>Action Type</h3></label>
                                    <select id="actionsactiontypejqmselect" class="actiontypeselect">
                                        <option value="email">Email</option>
                                        <option value="indicator">Indicator</option>
                                    </select>
                                </li>
                                <li>
                                    <h3>Detail</h3>
                                    <div class="ui-grid-a">
                                        <div class="ui-block-a ui-buttontextpartner" "><input type="text" class="actionsname' + index + 'text"  value="detail"style="margin-top:0px" ></div>
                                        <div class="ui-block-b channelsname' + index + 'textupdate" id="channelsname' + index + 'textupdate" ><a data-theme="d" data-role="button" data-icon="check">Update</a></div>
                                    </div>
                                </li>
                                <li>
                                    <label for="selectpositiveoutput"><h3>Action Type</h3></label>
                                    <select id="actionsactiontypejqmselect" class="actiontypeselect">
                                      <option value="standard">Email</option>
                                      <option value="rush">Indicator</option>
                                    </select>
                                </li>
                                <li data-role="fieldcontain">
                                    <label for="actionstatustoggle"  style="display:inline-block; width:50%;" class="ui-biglabel inset-header">
                                    Active Reset
                                    </label>
                                    <select id="actionstatustoggle" class="actionstatustoggle justalamp" data-role="slider">
                                    <option value="Off">Off</option>
                                    <option value="On">On</option>
                                    </select>
                                </li>
                                <li data-role="fieldcontain">
                                  <label for="slider-1" class="ui-biglabel">On Delay</label>
                                  <input type="range" name="slider-1" id="slider-1" value="60" min="0" max="100" />
                                </li>
                                <li data-role="fieldcontain">
                                  <label for="slider-1" class="ui-biglabel">Off Delay</label>
                                  <input type="range" name="slider-1" id="slider-1" value="60" min="0" max="100" />
                                </li>
                                <li data-role="fieldcontain">
                                  <label for="slider-1" class="ui-biglabel">Alert Frequency</label>
                                  <input type="range" name="slider-1" id="slider-1" value="60" min="0" max="100" />
                                </li>
                            </ul><!-- Edit set-->
                        </div><!-- Edit collapsible -->
                    </li><!-- Edit Collapsible set -->
                </div> <!-- Control Item -->
            </div><!--collapsible control item ACTION SET -->

            <li data-role="fieldcontain">
		        <a href="actionsedit.html" data-ajax="false">Add/Delete/Rename</a>
		    </li>
        </ul>
    </div><!--content-primary-->
</div><!--content-->
</div><!-- page -->
</body>
</html>
