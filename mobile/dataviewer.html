<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" >


    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />


    <title>CuPID Dataviewer</title>

    <script src="js/jquery-1.7.1.min.js"></script>
    <link rel="stylesheet" href="css/jquery.mobile-1.2.1.css" />
    <script src="js/jquery.mobile-1.2.1.js"></script>
    <link rel="stylesheet" href="css/jqm-docs.css" />
    <link rel="stylesheet" href="css/CuPID.css" />
    <script src="js/jqm-docs.js"></script>

    <script language="javascript" type="text/javascript" src="js/jqplot/jquery.jqplot.min.js"></script>
    <link rel="stylesheet" type="text/css" href="js/jqplot/jquery.jqplot.css" />
    <script type="text/javascript" src="js/jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script type="text/javascript" src="js/jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="js/jqplot/plugins/jqplot.dateAxisRenderer.js"></script>
    <script type="text/javascript" src="js/jqplot/plugins/jqplot.cursor.min.js"></script>

    <script src="/js/iijslib.js" type="text/javascript"></script>
    <script src="/js/cupidjslib.js" type="text/javascript"></script>
</head>
<body>

<div data-role="page" class="type-home" id="main">
<script>

// Define our usr for access control of features:


// Set objects. not used yet.
//var plotdefs = new plotdefs()
//plotdefs.plotids=[]
//plotdefs.series=[[[]]]
//plotdefs.plotids.push('myplotid')
//plotdefs.series.push([[['/var/www/data/controldata.db','channels','channel 1data']]])

// define some globals
var jqmpage=true;
var inputids=[];
var inputnames=[];
var inputgroups=[];
var channelsdata=[];
var channelnames=[];
var channellogdata=[];
var renderclassnames=[];

var updatetimeout=100;
var loginterval=30000;
var updateinterval=30000;

var setpointvalueseries=[];
var controlvalueseries=[];
var actionseries=[];

var actauthlevel=2;

//// Channels
function UpdateChannelsTable() {
    var callback=RenderChannels;
    wsgiCallbackTableData(controldatabase,'channels',callback);
}
function RenderChannels(channelstable) {
    channelnames=['none']
    channelsdata=channelstable
    for (var i=0; i<channelstable.length;i++){
        channelnames.push(channelstable[i].name)
    }

    var divhtmlstring;
    $("#channelset").html('');
    for (i=0; i<channelsdata.length; i++){
        index=i+1;
        divhtmlitemstring = '\
		   <div data-role="collapsible" data-collapsed="true" data-count-theme="b" ><!--control item --> \
    <h3> '  + channelsdata[i].name + '</h3>\
    <li data-role="fieldcontain">\
    <fieldset class="ui-grid-a">\
    <div class="ui-block-a ui-biglabel inset-header" id="controlvalue">Control Value</div>\
    <div class="ui-block-b ui-biggerlabel inset-header channelscontrolvalue' + index + '">63</div>\
    </fieldset>\
    </li>\
    <li data-role="fieldcontain">\
    <fieldset class="ui-grid-a">\
    <div class="ui-block-a ui-biglabel inset-header">Setpoint Value\
    </div>\
    <div class="ui-block-b ui-biggerlabel inset-header channelssetpointvalue' + index + '">63</div>\
    </fieldset>\
    </li>  \
    <li data-role="fieldcontain">\
    <fieldset class="ui-grid-a">\
    <div class="ui-block-a ui-biglabel inset-header">Action (%)\
    </div>\
    <div class="ui-block-b ui-biggerlabel inset-header channelsaction' + index + '">1</div>	   \
    </fieldset>\
    </li> \
    <li data-role="collapsible-set" data-content-theme="c" data-theme="d" data-inset="true">\
    <div data-role="collapsible" data-collapsed="true" >\
    <h4>Edit</h4>\
    <ul data-role="listview" data-inset="false" class="controllist">\
    <li >\
    <label for="slider-1" class="ui-biglabel" style="width:100%; padding-right:10px">Setpoint</label>\
    <input type="range" name="slider-1" class="channelsetpointvalueslider' + index + '" id="channelsetpointvalueslider' + index + '"  value="60" min="0" max="100" />\
    </li>\
    <li data-role="fieldcontain" >\
    <label for="channelsenabled' + index +  'toggle" class="ui-biglabel" style="display:inline-block; width:45%;"><h3>Enabled:</h3></label>\
    <select name="channelsenabled' + index +  'toggle" class="channelsenabled' + index +  'toggle" data-role="slider">\
    <option value="Off">Off</option>\
    <option value="On">On</option>\
    </select> \
    </li>\
    <li data-role="fieldcontain" >\
    <label for="channelsmode' + index +  'automantoggle" style="display:inline-block; width:45%;"><h3>Mode:</h3></label>\
    <select name="channelsmode' + index +  'automantoggle" class="channelsmode' + index +  'automantoggle" data-role="slider">\
    <option value="auto">auto</option>\
    <option value="manual">man</option>\
    </select> \
    </li>\
    <li data-role="fieldcontain">\
    <label for="channelsoutputsenabled' + index + 'toggle" style="width:45%; display:inline-block">\
    <h3>Outputs:</h3></label>\
    <select name="channelsoutputsenabled' + index + 'toggle" class="channelsoutputsenabled' + index + 'toggle" id="channelselect channelsoutputsenabled' + index + 'toggle" data-role="slider">\
    <option value="Off">Off</option>\
    <option value="On">On</option>\
    </select> \
    </li>\
    <li >\
    <label for="channelscontrolinput' + index + 'jqmselect" class="ui-biglabel"><h3>Control Input</h3></label>\
    <select name="channelscontrolinput' + index + 'jqmselect" class="inputselect channelscontrolinput' + index + 'jqmselect" id="channelscontrolinput' + index + 'jqmselect">\
    <option value="standard">Output 1</option>\
    <option value="rush">Output</option>\
    <option value="express">Output 3</option>\
    <option value="overnight">Output 4</option>\
    </select>\
    </li><!-- list option set -->\
    <li >\
    <label for="channelspositiveoutput' + index + 'jqmselect" class="ui-biglabel"><h3>Positive Output</h3></label>\
    <select name="channelspositiveoutput' + index + 'jqmselect" class="outputselect channelspositiveoutput' + index + 'jqmselect" id="channelspositiveoutput' + index + 'jqmselect">\
    <option value="standard">Output 1</option>\
    <option value="rush">Output</option>\
    <option value="express">Output 3</option>\
    <option value="overnight">Output 4</option>\
    </select>\
    <label for="channelsnegativeoutput' + index + 'jqmselect" class="ui-biglabel">Negative Output</label>\
    <select name="channelsnegativeoutput' + index + 'jqmselect" class="outputselect channelsnegativeoutput' + index + 'jqmselect" id="channelsnegativeoutput' + index + 'jqmselect">\
    <option value="standard">Output 1</option>\
    <option value="rush">Output 2</option>\
    <option value="express">Output 3</option>\
    <option value="overnight">Output 4</option>\
    </select>\
    </li><!-- list option set -->\
    <li>\
    <label for="channelscontrolalgorithm' + index + 'jqmselect" class="ui-biglabel">Control Algorithm</label>\
    <select name="channelscontrolalgorithm' + index + 'jqmselect" class="controlalgorithmselect channelscontrolalgorithm' + index + 'jqmselect" id="channelscontrolalgorithm' + index + 'jqmselect">\
    <option value="standard">on/off two degree deadband</option>\
    <option value="rush">on/off three degree deadband</option>\
    <option value="express">on/off two degree deadband</option>\
    <option value="value4">two degree deadband</option>\
    </select>\
    <label for="channelscontrolrecipe' + index + 'jqmselect"  class="ui-biglabel">Control Recipe</label>\
    <select name="channelscontrolrecipe' + index + 'jqmselect" class="controlrecipeselect channelscontrolrecipe' + index + 'jqmselect" id="channelscontrolrecipe' + index + 'jqmselect">\
    <option value="standard">stdreflow</option>\
    <option value="rush">Four-day 65F ale</option>\
    <option value="express">Six-day 65F ale</option>\
    <option value="overnight">Twelve-day 65F ale</option>\
    </select>\
    </li><!-- list option set -->\
    </ul><!-- Edit set-->\
    </div><!-- Edit collapsible -->\
    <div data-role="collapsible" data-collapsed="true" class="smallplotcollapsible" id="smallplotcollapsible' + index + '">\
    <h4><span style="float:left;">Quick Plot</span>\
    <span class="' + channelsdata[i].name.replace(' ','_') + 'logpoints ui-btn-up-c  ui-btn-corner-all cnt" style="float:right; font-size:12px; padding-left:7px; padding-right:7px">0</span></h4>\
    <div class="smallplot" id="smallplot' + index + '">Loading ...</div>\
    </div><!-- plot collapsible -->\
    </li><!-- Edit Collapsible set -->\
    </div><!--collapsible control item --> '

        $(divhtmlitemstring).appendTo("#channelset").trigger( "create" );

        $('#smallplotcollapsible' + index).bind('expand',  { index: index }, function(event) {
            var data=event.data

            // Send index of channel and name of div to render to
            //GetAndRenderPlotData([channelsdata[data.index].name],["smallplot" + data.index])
            channelindex=data.index-1
            logtablename=channelsdata[channelindex].name + "log"
            GetAndRenderLogData({'logtablename':logtablename,'renderplotids':['smallplot' + data.index],renderplotoptions:[channelOptionsObj]})
        })

    }

    <!--$('#channelscontainer').html(divhtmlstring)-->
    $('#channelset').collapsibleset('refresh')
    $('#channellistview').listview('refresh')
    UpdateChannelsData()
}


$(document).ready(function(){
    togglestolamps()

    //// Control Algorithms
    // UpdateLogsTable({'timeout':updateinterval})
    $('#plotrefresh').click(function(event){
        //UpdateInputsTable()
        channelOptionsObj.axes.yaxis.min=0;
        channelOptionsObj.axes.yaxis.min=100;
        GetAndRenderLogData({logtablename:'channel 1log',renderplotids:['plot'],renderplotoptions:[channelOptionsObj]})
    });
});
</script>
<div data-role="content">
<div class="content-secondary">
    <ul data-role="listview" data-inset="true">
        <li data-role="list-divider"><h4>Plot Controls</h4></li>
        <li data-role="fieldcontain" >
            A Log Channel
        </li>
        <li class="sm-inset-header">
            <label for="plotpointsslider" style="width:100%; padding-right:40px">Plot Points</label>
            <input type="range" id="plotpointsslider" class="plotpointsslider" value="55" min="0" max="100" />
        </li>
        <li class="sm-inset-header">
            <label for="plotpointsslider" style="width:100%; padding-right:40px">Update Frequency</label>
            <input type="range" id="plotpointsslider" class="plotpointsslider" value="55" min="0" max="100" />
        </li>
        <li data-role="fieldcontain">
            <a href="logviewer.html">Log Viewer</a>
        </li>
    </ul>
    <div data-role="button" data-theme="c" id="plotrefresh">Refresh</div>
</div><!--/content-secondary-->
<div class="content-primary">
    <ul data-role="listview" data-inset="true" data-dividertheme="c" id="channellistview">
        <li data-role="list-divider">
            <h4>Content Selection</h4>
        </li>
        <li data-role="fieldcontain" >
            <div class="ui-biglabel">A Log Channel
            </div>
            <fieldset class="ui-grid-a" style="margin-top:10px">
                <div class="ui-block-a ">
                    <select name="plotme" class="plotme" data-role="slider">
                        <option value="Off">Off</option>
                        <option value="On">On</option>
                    </select>
                </div>
                <div class="ui-block-b ui-btn-up-d  ui-btn-corner-all cnt" style="float:right; margin:5px 10px 5px 10px; padding: 7px 10px; text-align: center; width: 60px">52
                </div>
            </fieldset>
        </li>
        <li data-role="fieldcontain">
            <a href="channelsedit.html">Add/Delete/Rename</a>
        </li>
    </ul>
    <ul data-role="listview" data-inset="true" data-dividertheme="c" id="channellistview">
        <li data-role="list-divider">
            <h4>Data Plot</h4>
        </li>
        <li data-role="fieldcontain" >
            <div id="plot" class="plot"></div>
        </li>
    </ul>
</div><!--content-primary-->
</div><!--content-->
</div><!-- page -->
</body>
</html>
